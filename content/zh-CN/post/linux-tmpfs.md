---
title: "linux tmpfs"
date: "2022-06-06 12:07:21"
categories:
  - Linux
tags:
  - Linux
toc: true
math: true
type: about
---

​	tmpfs,临时文件系统，是一种基于内存的文件系统，它和虚拟磁盘ramdisk比较类似像，但不完全相同，和ramdisk一样，tmpfs可以使用RAM，但它也可以使用swap分区来存储，而且传统的ramdisk是个[块设备](https://baike.baidu.com/item/块设备/2413231?fromModule=lemma_inlink)，要用mkfs来格式化它，才能真正地使用它；而tmpfs是一个文件系统，并不是块设备，只是安装它，就可以使用了。tmpfs是最好的基于RAM的文件系统。

#### 特点

1. 动态文件系统大小

   /mnt/tmpfs最初会只有很小的空间，但随着文件的复制和创建，tmpfs文件系统驱动程序会分配更多的 VM，并按照需求动态地增加文件系统的空间。而且，当 /mnt/tmpfs 中的文件被删除时，tmpfs 文件系统驱动程序会**动态地减小文件系统并释放 VM 资源**，这样做可以将 VM 返回到循环当中以供系统中其它部分按需要使用。因为 VM 是宝贵的资源，所以您一定不希望任何东西浪费超出它实际所需的 VM，tmpfs 的好处之一就在于这些都是自动处理的。

2. 速度快（快速读写能力）

   tmpfs 的另一个主要的好处是它闪电般的速度。因为典型的 tmpfs 文件系统会完全驻留在 RAM 中，读写几乎可以是瞬间的。即使用了一些[交换分区](https://baike.baidu.com/item/交换分区?fromModule=lemma_inlink)，性能仍然是卓越的，当更多空闲的 VM 资源可以使用时，这部分 tmpfs 文件系统会被移动到 RAM 中去。让 VM 子系统自动地移动部分 tmpfs 文件系统到交换分区实际上对性能上是好的，因为这样做可以让 VM 子系统为需要 RAM 的进程释放空间。这一点连同它动态调整大小的能力，比选择使用传统的 RAM 磁盘可以让操作系统有好得多的整体性能和灵活性。

3.  临时性

   由于tmpfs是构建在内存中的，所以存放在tmpfs中的所有数据在卸载或断电后都会丢失

#### 一些使用场景

​	例如在公司中（目前我们公司用的是mongodb）对于数据读写操作速度要求比较高的情况下，我会跑2个mongodb进程，一个数据挂载在硬盘上（这里称为**mongdb-A**），另一个挂载在内存中（/run、/dev/shm......）（这里称为**mongdb-B**）。在操作时，我们将当天没有处理完的数据存到**mongdb-B**中，等到数据完全处理完之后，把已经处理好的数据迁移到**mongdb-A**中，同时删除**mongdb-B**这条已经处理好的数据。
